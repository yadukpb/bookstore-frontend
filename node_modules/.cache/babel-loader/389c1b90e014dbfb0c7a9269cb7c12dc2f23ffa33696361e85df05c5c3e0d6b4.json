{"ast":null,"code":"import { unwrap as aesKw } from '../runtime/aeskw.js';\nimport * as ECDH from '../runtime/ecdhes.js';\nimport { decrypt as pbes2Kw } from '../runtime/pbes2kw.js';\nimport { decrypt as rsaEs } from '../runtime/rsaes.js';\nimport { decode as base64url } from '../runtime/base64url.js';\nimport { JOSENotSupported, JWEInvalid } from '../util/errors.js';\nimport { bitLength as cekLength } from '../lib/cek.js';\nimport { importJWK } from '../key/import.js';\nimport checkKeyType from './check_key_type.js';\nimport isObject from './is_object.js';\nimport { unwrap as aesGcmKw } from './aesgcmkw.js';\nasync function decryptKeyManagement(alg, key, encryptedKey, joseHeader, options) {\n  checkKeyType(alg, key, 'decrypt');\n  switch (alg) {\n    case 'dir':\n      {\n        if (encryptedKey !== undefined) throw new JWEInvalid('Encountered unexpected JWE Encrypted Key');\n        return key;\n      }\n    case 'ECDH-ES':\n      if (encryptedKey !== undefined) throw new JWEInvalid('Encountered unexpected JWE Encrypted Key');\n    case 'ECDH-ES+A128KW':\n    case 'ECDH-ES+A192KW':\n    case 'ECDH-ES+A256KW':\n      {\n        if (!isObject(joseHeader.epk)) throw new JWEInvalid(`JOSE Header \"epk\" (Ephemeral Public Key) missing or invalid`);\n        if (!ECDH.ecdhAllowed(key)) throw new JOSENotSupported('ECDH with the provided key is not allowed or not supported by your javascript runtime');\n        const epk = await importJWK(joseHeader.epk, alg);\n        let partyUInfo;\n        let partyVInfo;\n        if (joseHeader.apu !== undefined) {\n          if (typeof joseHeader.apu !== 'string') throw new JWEInvalid(`JOSE Header \"apu\" (Agreement PartyUInfo) invalid`);\n          try {\n            partyUInfo = base64url(joseHeader.apu);\n          } catch (_a) {\n            throw new JWEInvalid('Failed to base64url decode the apu');\n          }\n        }\n        if (joseHeader.apv !== undefined) {\n          if (typeof joseHeader.apv !== 'string') throw new JWEInvalid(`JOSE Header \"apv\" (Agreement PartyVInfo) invalid`);\n          try {\n            partyVInfo = base64url(joseHeader.apv);\n          } catch (_b) {\n            throw new JWEInvalid('Failed to base64url decode the apv');\n          }\n        }\n        const sharedSecret = await ECDH.deriveKey(epk, key, alg === 'ECDH-ES' ? joseHeader.enc : alg, alg === 'ECDH-ES' ? cekLength(joseHeader.enc) : parseInt(alg.slice(-5, -2), 10), partyUInfo, partyVInfo);\n        if (alg === 'ECDH-ES') return sharedSecret;\n        if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n        return aesKw(alg.slice(-6), sharedSecret, encryptedKey);\n      }\n    case 'RSA1_5':\n    case 'RSA-OAEP':\n    case 'RSA-OAEP-256':\n    case 'RSA-OAEP-384':\n    case 'RSA-OAEP-512':\n      {\n        if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n        return rsaEs(alg, key, encryptedKey);\n      }\n    case 'PBES2-HS256+A128KW':\n    case 'PBES2-HS384+A192KW':\n    case 'PBES2-HS512+A256KW':\n      {\n        if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n        if (typeof joseHeader.p2c !== 'number') throw new JWEInvalid(`JOSE Header \"p2c\" (PBES2 Count) missing or invalid`);\n        const p2cLimit = (options === null || options === void 0 ? void 0 : options.maxPBES2Count) || 10000;\n        if (joseHeader.p2c > p2cLimit) throw new JWEInvalid(`JOSE Header \"p2c\" (PBES2 Count) out is of acceptable bounds`);\n        if (typeof joseHeader.p2s !== 'string') throw new JWEInvalid(`JOSE Header \"p2s\" (PBES2 Salt) missing or invalid`);\n        let p2s;\n        try {\n          p2s = base64url(joseHeader.p2s);\n        } catch (_c) {\n          throw new JWEInvalid('Failed to base64url decode the p2s');\n        }\n        return pbes2Kw(alg, key, encryptedKey, joseHeader.p2c, p2s);\n      }\n    case 'A128KW':\n    case 'A192KW':\n    case 'A256KW':\n      {\n        if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n        return aesKw(alg, key, encryptedKey);\n      }\n    case 'A128GCMKW':\n    case 'A192GCMKW':\n    case 'A256GCMKW':\n      {\n        if (encryptedKey === undefined) throw new JWEInvalid('JWE Encrypted Key missing');\n        if (typeof joseHeader.iv !== 'string') throw new JWEInvalid(`JOSE Header \"iv\" (Initialization Vector) missing or invalid`);\n        if (typeof joseHeader.tag !== 'string') throw new JWEInvalid(`JOSE Header \"tag\" (Authentication Tag) missing or invalid`);\n        let iv;\n        try {\n          iv = base64url(joseHeader.iv);\n        } catch (_d) {\n          throw new JWEInvalid('Failed to base64url decode the iv');\n        }\n        let tag;\n        try {\n          tag = base64url(joseHeader.tag);\n        } catch (_e) {\n          throw new JWEInvalid('Failed to base64url decode the tag');\n        }\n        return aesGcmKw(alg, key, encryptedKey, iv, tag);\n      }\n    default:\n      {\n        throw new JOSENotSupported('Invalid or unsupported \"alg\" (JWE Algorithm) header value');\n      }\n  }\n}\nexport default decryptKeyManagement;","map":{"version":3,"names":["unwrap","aesKw","ECDH","decrypt","pbes2Kw","rsaEs","decode","base64url","JOSENotSupported","JWEInvalid","bitLength","cekLength","importJWK","checkKeyType","isObject","aesGcmKw","decryptKeyManagement","alg","key","encryptedKey","joseHeader","options","undefined","epk","ecdhAllowed","partyUInfo","partyVInfo","apu","_a","apv","_b","sharedSecret","deriveKey","enc","parseInt","slice","p2c","p2cLimit","maxPBES2Count","p2s","_c","iv","tag","_d","_e"],"sources":["/home/yadu/Music/Gifty/node_modules/jose/dist/browser/lib/decrypt_key_management.js"],"sourcesContent":["import { unwrap as aesKw } from '../runtime/aeskw.js';\nimport * as ECDH from '../runtime/ecdhes.js';\nimport { decrypt as pbes2Kw } from '../runtime/pbes2kw.js';\nimport { decrypt as rsaEs } from '../runtime/rsaes.js';\nimport { decode as base64url } from '../runtime/base64url.js';\nimport { JOSENotSupported, JWEInvalid } from '../util/errors.js';\nimport { bitLength as cekLength } from '../lib/cek.js';\nimport { importJWK } from '../key/import.js';\nimport checkKeyType from './check_key_type.js';\nimport isObject from './is_object.js';\nimport { unwrap as aesGcmKw } from './aesgcmkw.js';\nasync function decryptKeyManagement(alg, key, encryptedKey, joseHeader, options) {\n    checkKeyType(alg, key, 'decrypt');\n    switch (alg) {\n        case 'dir': {\n            if (encryptedKey !== undefined)\n                throw new JWEInvalid('Encountered unexpected JWE Encrypted Key');\n            return key;\n        }\n        case 'ECDH-ES':\n            if (encryptedKey !== undefined)\n                throw new JWEInvalid('Encountered unexpected JWE Encrypted Key');\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            if (!isObject(joseHeader.epk))\n                throw new JWEInvalid(`JOSE Header \"epk\" (Ephemeral Public Key) missing or invalid`);\n            if (!ECDH.ecdhAllowed(key))\n                throw new JOSENotSupported('ECDH with the provided key is not allowed or not supported by your javascript runtime');\n            const epk = await importJWK(joseHeader.epk, alg);\n            let partyUInfo;\n            let partyVInfo;\n            if (joseHeader.apu !== undefined) {\n                if (typeof joseHeader.apu !== 'string')\n                    throw new JWEInvalid(`JOSE Header \"apu\" (Agreement PartyUInfo) invalid`);\n                try {\n                    partyUInfo = base64url(joseHeader.apu);\n                }\n                catch (_a) {\n                    throw new JWEInvalid('Failed to base64url decode the apu');\n                }\n            }\n            if (joseHeader.apv !== undefined) {\n                if (typeof joseHeader.apv !== 'string')\n                    throw new JWEInvalid(`JOSE Header \"apv\" (Agreement PartyVInfo) invalid`);\n                try {\n                    partyVInfo = base64url(joseHeader.apv);\n                }\n                catch (_b) {\n                    throw new JWEInvalid('Failed to base64url decode the apv');\n                }\n            }\n            const sharedSecret = await ECDH.deriveKey(epk, key, alg === 'ECDH-ES' ? joseHeader.enc : alg, alg === 'ECDH-ES' ? cekLength(joseHeader.enc) : parseInt(alg.slice(-5, -2), 10), partyUInfo, partyVInfo);\n            if (alg === 'ECDH-ES')\n                return sharedSecret;\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            return aesKw(alg.slice(-6), sharedSecret, encryptedKey);\n        }\n        case 'RSA1_5':\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            return rsaEs(alg, key, encryptedKey);\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            if (typeof joseHeader.p2c !== 'number')\n                throw new JWEInvalid(`JOSE Header \"p2c\" (PBES2 Count) missing or invalid`);\n            const p2cLimit = (options === null || options === void 0 ? void 0 : options.maxPBES2Count) || 10000;\n            if (joseHeader.p2c > p2cLimit)\n                throw new JWEInvalid(`JOSE Header \"p2c\" (PBES2 Count) out is of acceptable bounds`);\n            if (typeof joseHeader.p2s !== 'string')\n                throw new JWEInvalid(`JOSE Header \"p2s\" (PBES2 Salt) missing or invalid`);\n            let p2s;\n            try {\n                p2s = base64url(joseHeader.p2s);\n            }\n            catch (_c) {\n                throw new JWEInvalid('Failed to base64url decode the p2s');\n            }\n            return pbes2Kw(alg, key, encryptedKey, joseHeader.p2c, p2s);\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            return aesKw(alg, key, encryptedKey);\n        }\n        case 'A128GCMKW':\n        case 'A192GCMKW':\n        case 'A256GCMKW': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            if (typeof joseHeader.iv !== 'string')\n                throw new JWEInvalid(`JOSE Header \"iv\" (Initialization Vector) missing or invalid`);\n            if (typeof joseHeader.tag !== 'string')\n                throw new JWEInvalid(`JOSE Header \"tag\" (Authentication Tag) missing or invalid`);\n            let iv;\n            try {\n                iv = base64url(joseHeader.iv);\n            }\n            catch (_d) {\n                throw new JWEInvalid('Failed to base64url decode the iv');\n            }\n            let tag;\n            try {\n                tag = base64url(joseHeader.tag);\n            }\n            catch (_e) {\n                throw new JWEInvalid('Failed to base64url decode the tag');\n            }\n            return aesGcmKw(alg, key, encryptedKey, iv, tag);\n        }\n        default: {\n            throw new JOSENotSupported('Invalid or unsupported \"alg\" (JWE Algorithm) header value');\n        }\n    }\n}\nexport default decryptKeyManagement;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}