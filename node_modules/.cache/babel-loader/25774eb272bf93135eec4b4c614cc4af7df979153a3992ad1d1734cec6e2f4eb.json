{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.X509 = void 0;\nconst error_1 = require(\"../../error\");\nconst utils_1 = require(\"../../utils\");\nconst auth_provider_1 = require(\"./auth_provider\");\nclass X509 extends auth_provider_1.AuthProvider {\n  async prepare(handshakeDoc, authContext) {\n    const {\n      credentials\n    } = authContext;\n    if (!credentials) {\n      throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n    }\n    return {\n      ...handshakeDoc,\n      speculativeAuthenticate: x509AuthenticateCommand(credentials)\n    };\n  }\n  async auth(authContext) {\n    const connection = authContext.connection;\n    const credentials = authContext.credentials;\n    if (!credentials) {\n      throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n    }\n    const response = authContext.response;\n    if (response?.speculativeAuthenticate) {\n      return;\n    }\n    await connection.command((0, utils_1.ns)('$external.$cmd'), x509AuthenticateCommand(credentials), undefined);\n  }\n}\nexports.X509 = X509;\nfunction x509AuthenticateCommand(credentials) {\n  const command = {\n    authenticate: 1,\n    mechanism: 'MONGODB-X509'\n  };\n  if (credentials.username) {\n    command.user = credentials.username;\n  }\n  return command;\n}","map":{"version":3,"mappings":";;;;;;AACA;AACA;AAEA;AAGA,MAAaA,IAAK,SAAQC,4BAAY;EAC3B,MAAMC,OAAO,CACpBC,YAA+B,EAC/BC,WAAwB;IAExB,MAAM;MAAEC;IAAW,CAAE,GAAGD,WAAW;IACnC,IAAI,CAACC,WAAW,EAAE;MAChB,MAAM,IAAIC,oCAA4B,CAAC,uCAAuC,CAAC;IACjF;IACA,OAAO;MAAE,GAAGH,YAAY;MAAEI,uBAAuB,EAAEC,uBAAuB,CAACH,WAAW;IAAC,CAAE;EAC3F;EAES,MAAMI,IAAI,CAACL,WAAwB;IAC1C,MAAMM,UAAU,GAAGN,WAAW,CAACM,UAAU;IACzC,MAAML,WAAW,GAAGD,WAAW,CAACC,WAAW;IAC3C,IAAI,CAACA,WAAW,EAAE;MAChB,MAAM,IAAIC,oCAA4B,CAAC,uCAAuC,CAAC;IACjF;IACA,MAAMK,QAAQ,GAAGP,WAAW,CAACO,QAAQ;IAErC,IAAIA,QAAQ,EAAEJ,uBAAuB,EAAE;MACrC;IACF;IAEA,MAAMG,UAAU,CAACE,OAAO,CAAC,cAAE,EAAC,gBAAgB,CAAC,EAAEJ,uBAAuB,CAACH,WAAW,CAAC,EAAEQ,SAAS,CAAC;EACjG;;AAzBFC;AA4BA,SAASN,uBAAuB,CAACH,WAA6B;EAC5D,MAAMO,OAAO,GAAa;IAAEG,YAAY,EAAE,CAAC;IAAEC,SAAS,EAAE;EAAc,CAAE;EACxE,IAAIX,WAAW,CAACY,QAAQ,EAAE;IACxBL,OAAO,CAACM,IAAI,GAAGb,WAAW,CAACY,QAAQ;EACrC;EAEA,OAAOL,OAAO;AAChB","names":["X509","auth_provider_1","prepare","handshakeDoc","authContext","credentials","error_1","speculativeAuthenticate","x509AuthenticateCommand","auth","connection","response","command","undefined","exports","authenticate","mechanism","username","user"],"sources":["/home/yadu/Music/Gifty/node_modules/mongodb/src/cmap/auth/x509.ts"],"sourcesContent":["import type { Document } from '../../bson';\nimport { MongoMissingCredentialsError } from '../../error';\nimport { ns } from '../../utils';\nimport type { HandshakeDocument } from '../connect';\nimport { type AuthContext, AuthProvider } from './auth_provider';\nimport type { MongoCredentials } from './mongo_credentials';\n\nexport class X509 extends AuthProvider {\n  override async prepare(\n    handshakeDoc: HandshakeDocument,\n    authContext: AuthContext\n  ): Promise<HandshakeDocument> {\n    const { credentials } = authContext;\n    if (!credentials) {\n      throw new MongoMissingCredentialsError('AuthContext must provide credentials.');\n    }\n    return { ...handshakeDoc, speculativeAuthenticate: x509AuthenticateCommand(credentials) };\n  }\n\n  override async auth(authContext: AuthContext) {\n    const connection = authContext.connection;\n    const credentials = authContext.credentials;\n    if (!credentials) {\n      throw new MongoMissingCredentialsError('AuthContext must provide credentials.');\n    }\n    const response = authContext.response;\n\n    if (response?.speculativeAuthenticate) {\n      return;\n    }\n\n    await connection.command(ns('$external.$cmd'), x509AuthenticateCommand(credentials), undefined);\n  }\n}\n\nfunction x509AuthenticateCommand(credentials: MongoCredentials) {\n  const command: Document = { authenticate: 1, mechanism: 'MONGODB-X509' };\n  if (credentials.username) {\n    command.user = credentials.username;\n  }\n\n  return command;\n}\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}