{"ast":null,"code":"\"use strict\";\n\n// Copyright 2018 Google LLC\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nvar _a;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.GaxiosError = exports.GAXIOS_ERROR_SYMBOL = void 0;\nexports.defaultErrorRedactor = defaultErrorRedactor;\nconst url_1 = require(\"url\");\nconst util_1 = require(\"./util\");\nconst extend_1 = __importDefault(require(\"extend\"));\n/**\n * Support `instanceof` operator for `GaxiosError`s in different versions of this library.\n *\n * @see {@link GaxiosError[Symbol.hasInstance]}\n */\nexports.GAXIOS_ERROR_SYMBOL = Symbol.for(`${util_1.pkg.name}-gaxios-error`);\n/* eslint-disable-next-line @typescript-eslint/no-explicit-any */\nclass GaxiosError extends Error {\n  /**\n   * Support `instanceof` operator for `GaxiosError` across builds/duplicated files.\n   *\n   * @see {@link GAXIOS_ERROR_SYMBOL}\n   * @see {@link GaxiosError[GAXIOS_ERROR_SYMBOL]}\n   */\n  static [(_a = exports.GAXIOS_ERROR_SYMBOL, Symbol.hasInstance)](instance) {\n    if (instance && typeof instance === 'object' && exports.GAXIOS_ERROR_SYMBOL in instance && instance[exports.GAXIOS_ERROR_SYMBOL] === util_1.pkg.version) {\n      return true;\n    }\n    // fallback to native\n    return Function.prototype[Symbol.hasInstance].call(GaxiosError, instance);\n  }\n  constructor(message, config, response, error) {\n    var _b;\n    super(message);\n    this.config = config;\n    this.response = response;\n    this.error = error;\n    /**\n     * Support `instanceof` operator for `GaxiosError` across builds/duplicated files.\n     *\n     * @see {@link GAXIOS_ERROR_SYMBOL}\n     * @see {@link GaxiosError[Symbol.hasInstance]}\n     * @see {@link https://github.com/microsoft/TypeScript/issues/13965#issuecomment-278570200}\n     * @see {@link https://stackoverflow.com/questions/46618852/require-and-instanceof}\n     * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/@@hasInstance#reverting_to_default_instanceof_behavior}\n     */\n    this[_a] = util_1.pkg.version;\n    // deep-copy config as we do not want to mutate\n    // the existing config for future retries/use\n    this.config = (0, extend_1.default)(true, {}, config);\n    if (this.response) {\n      this.response.config = (0, extend_1.default)(true, {}, this.response.config);\n    }\n    if (this.response) {\n      try {\n        this.response.data = translateData(this.config.responseType, (_b = this.response) === null || _b === void 0 ? void 0 : _b.data);\n      } catch (_c) {\n        // best effort - don't throw an error within an error\n        // we could set `this.response.config.responseType = 'unknown'`, but\n        // that would mutate future calls with this config object.\n      }\n      this.status = this.response.status;\n    }\n    if (error && 'code' in error && error.code) {\n      this.code = error.code;\n    }\n    if (config.errorRedactor) {\n      config.errorRedactor({\n        config: this.config,\n        response: this.response\n      });\n    }\n  }\n}\nexports.GaxiosError = GaxiosError;\nfunction translateData(responseType, data) {\n  switch (responseType) {\n    case 'stream':\n      return data;\n    case 'json':\n      return JSON.parse(JSON.stringify(data));\n    case 'arraybuffer':\n      return JSON.parse(Buffer.from(data).toString('utf8'));\n    case 'blob':\n      return JSON.parse(data.text());\n    default:\n      return data;\n  }\n}\n/**\n * An experimental error redactor.\n *\n * @param config Config to potentially redact properties of\n * @param response Config to potentially redact properties of\n *\n * @experimental\n */\nfunction defaultErrorRedactor(data) {\n  const REDACT = '<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.';\n  function redactHeaders(headers) {\n    if (!headers) return;\n    for (const key of Object.keys(headers)) {\n      // any casing of `Authentication`\n      if (/^authentication$/i.test(key)) {\n        headers[key] = REDACT;\n      }\n      // any casing of `Authorization`\n      if (/^authorization$/i.test(key)) {\n        headers[key] = REDACT;\n      }\n      // anything containing secret, such as 'client secret'\n      if (/secret/i.test(key)) {\n        headers[key] = REDACT;\n      }\n    }\n  }\n  function redactString(obj, key) {\n    if (typeof obj === 'object' && obj !== null && typeof obj[key] === 'string') {\n      const text = obj[key];\n      if (/grant_type=/i.test(text) || /assertion=/i.test(text) || /secret/i.test(text)) {\n        obj[key] = REDACT;\n      }\n    }\n  }\n  function redactObject(obj) {\n    if (typeof obj === 'object' && obj !== null) {\n      if ('grant_type' in obj) {\n        obj['grant_type'] = REDACT;\n      }\n      if ('assertion' in obj) {\n        obj['assertion'] = REDACT;\n      }\n      if ('client_secret' in obj) {\n        obj['client_secret'] = REDACT;\n      }\n    }\n  }\n  if (data.config) {\n    redactHeaders(data.config.headers);\n    redactString(data.config, 'data');\n    redactObject(data.config.data);\n    redactString(data.config, 'body');\n    redactObject(data.config.body);\n    try {\n      const url = new url_1.URL('', data.config.url);\n      if (url.searchParams.has('token')) {\n        url.searchParams.set('token', REDACT);\n      }\n      if (url.searchParams.has('client_secret')) {\n        url.searchParams.set('client_secret', REDACT);\n      }\n      data.config.url = url.toString();\n    } catch (_b) {\n      // ignore error - no need to parse an invalid URL\n    }\n  }\n  if (data.response) {\n    defaultErrorRedactor({\n      config: data.response.config\n    });\n    redactHeaders(data.response.headers);\n    redactString(data.response, 'data');\n    redactObject(data.response.data);\n  }\n  return data;\n}","map":{"version":3,"mappings":"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","names":["exports","Symbol","for","util_1","name","GaxiosError","Error","_a","hasInstance","instance","version","Function","prototype","call","constructor","message","config","response","error","data","translateData","responseType","status","code","errorRedactor","JSON","parse","stringify","Buffer","from","toString","text","defaultErrorRedactor","REDACT","redactHeaders","headers","key","Object","keys","test","redactString","obj","redactObject","body","url","url_1","searchParams","has","set"],"sources":["../../src/common.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}