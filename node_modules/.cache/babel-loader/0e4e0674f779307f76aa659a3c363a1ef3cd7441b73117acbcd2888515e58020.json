{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MongoClientAuthProviders = void 0;\nconst gssapi_1 = require(\"./cmap/auth/gssapi\");\nconst mongodb_aws_1 = require(\"./cmap/auth/mongodb_aws\");\nconst mongodb_oidc_1 = require(\"./cmap/auth/mongodb_oidc\");\nconst automated_callback_workflow_1 = require(\"./cmap/auth/mongodb_oidc/automated_callback_workflow\");\nconst human_callback_workflow_1 = require(\"./cmap/auth/mongodb_oidc/human_callback_workflow\");\nconst token_cache_1 = require(\"./cmap/auth/mongodb_oidc/token_cache\");\nconst plain_1 = require(\"./cmap/auth/plain\");\nconst providers_1 = require(\"./cmap/auth/providers\");\nconst scram_1 = require(\"./cmap/auth/scram\");\nconst x509_1 = require(\"./cmap/auth/x509\");\nconst error_1 = require(\"./error\");\n/** @internal */\nconst AUTH_PROVIDERS = new Map([[providers_1.AuthMechanism.MONGODB_AWS, () => new mongodb_aws_1.MongoDBAWS()], [providers_1.AuthMechanism.MONGODB_CR, () => {\n  throw new error_1.MongoInvalidArgumentError('MONGODB-CR is no longer a supported auth mechanism in MongoDB 4.0+');\n}], [providers_1.AuthMechanism.MONGODB_GSSAPI, () => new gssapi_1.GSSAPI()], [providers_1.AuthMechanism.MONGODB_OIDC, workflow => new mongodb_oidc_1.MongoDBOIDC(workflow)], [providers_1.AuthMechanism.MONGODB_PLAIN, () => new plain_1.Plain()], [providers_1.AuthMechanism.MONGODB_SCRAM_SHA1, () => new scram_1.ScramSHA1()], [providers_1.AuthMechanism.MONGODB_SCRAM_SHA256, () => new scram_1.ScramSHA256()], [providers_1.AuthMechanism.MONGODB_X509, () => new x509_1.X509()]]);\n/**\n * Create a set of providers per client\n * to avoid sharing the provider's cache between different clients.\n * @internal\n */\nclass MongoClientAuthProviders {\n  constructor() {\n    this.existingProviders = new Map();\n  }\n  /**\n   * Get or create an authentication provider based on the provided mechanism.\n   * We don't want to create all providers at once, as some providers may not be used.\n   * @param name - The name of the provider to get or create.\n   * @param credentials - The credentials.\n   * @returns The provider.\n   * @throws MongoInvalidArgumentError if the mechanism is not supported.\n   * @internal\n   */\n  getOrCreateProvider(name, authMechanismProperties) {\n    const authProvider = this.existingProviders.get(name);\n    if (authProvider) {\n      return authProvider;\n    }\n    const providerFunction = AUTH_PROVIDERS.get(name);\n    if (!providerFunction) {\n      throw new error_1.MongoInvalidArgumentError(`authMechanism ${name} not supported`);\n    }\n    let provider;\n    if (name === providers_1.AuthMechanism.MONGODB_OIDC) {\n      provider = providerFunction(this.getWorkflow(authMechanismProperties));\n    } else {\n      provider = providerFunction();\n    }\n    this.existingProviders.set(name, provider);\n    return provider;\n  }\n  /**\n   * Gets either a device workflow or callback workflow.\n   */\n  getWorkflow(authMechanismProperties) {\n    if (authMechanismProperties.OIDC_HUMAN_CALLBACK) {\n      return new human_callback_workflow_1.HumanCallbackWorkflow(new token_cache_1.TokenCache(), authMechanismProperties.OIDC_HUMAN_CALLBACK);\n    } else if (authMechanismProperties.OIDC_CALLBACK) {\n      return new automated_callback_workflow_1.AutomatedCallbackWorkflow(new token_cache_1.TokenCache(), authMechanismProperties.OIDC_CALLBACK);\n    } else {\n      const environment = authMechanismProperties.ENVIRONMENT;\n      const workflow = mongodb_oidc_1.OIDC_WORKFLOWS.get(environment)?.();\n      if (!workflow) {\n        throw new error_1.MongoInvalidArgumentError(`Could not load workflow for environment ${authMechanismProperties.ENVIRONMENT}`);\n      }\n      return workflow;\n    }\n  }\n}\nexports.MongoClientAuthProviders = MongoClientAuthProviders;","map":{"version":3,"mappings":";;;;;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA,MAAMA,cAAc,GAAG,IAAIC,GAAG,CAAgE,CAC5F,CAACC,yBAAa,CAACC,WAAW,EAAE,MAAM,IAAIC,wBAAU,EAAE,CAAC,EACnD,CACEF,yBAAa,CAACG,UAAU,EACxB,MAAK;EACH,MAAM,IAAIC,iCAAyB,CACjC,oEAAoE,CACrE;AACH,CAAC,CACF,EACD,CAACJ,yBAAa,CAACK,cAAc,EAAE,MAAM,IAAIC,eAAM,EAAE,CAAC,EAClD,CAACN,yBAAa,CAACO,YAAY,EAAGC,QAAmB,IAAK,IAAIC,0BAAW,CAACD,QAAQ,CAAC,CAAC,EAChF,CAACR,yBAAa,CAACU,aAAa,EAAE,MAAM,IAAIC,aAAK,EAAE,CAAC,EAChD,CAACX,yBAAa,CAACY,kBAAkB,EAAE,MAAM,IAAIC,iBAAS,EAAE,CAAC,EACzD,CAACb,yBAAa,CAACc,oBAAoB,EAAE,MAAM,IAAID,mBAAW,EAAE,CAAC,EAC7D,CAACb,yBAAa,CAACe,YAAY,EAAE,MAAM,IAAIC,WAAI,EAAE,CAAC,CAC/C,CAAC;AAEF;;;;;AAKA,MAAaC,wBAAwB;EAArCC;IACU,sBAAiB,GAA8C,IAAInB,GAAG,EAAE;EA0DlF;EAxDE;;;;;;;;;EASAoB,mBAAmB,CACjBC,IAA4B,EAC5BC,uBAAgD;IAEhD,MAAMC,YAAY,GAAG,IAAI,CAACC,iBAAiB,CAACC,GAAG,CAACJ,IAAI,CAAC;IACrD,IAAIE,YAAY,EAAE;MAChB,OAAOA,YAAY;IACrB;IAEA,MAAMG,gBAAgB,GAAG3B,cAAc,CAAC0B,GAAG,CAACJ,IAAI,CAAC;IACjD,IAAI,CAACK,gBAAgB,EAAE;MACrB,MAAM,IAAIrB,iCAAyB,CAAC,iBAAiBgB,IAAI,gBAAgB,CAAC;IAC5E;IAEA,IAAIM,QAAQ;IACZ,IAAIN,IAAI,KAAKpB,yBAAa,CAACO,YAAY,EAAE;MACvCmB,QAAQ,GAAGD,gBAAgB,CAAC,IAAI,CAACE,WAAW,CAACN,uBAAuB,CAAC,CAAC;IACxE,CAAC,MAAM;MACLK,QAAQ,GAAGD,gBAAgB,EAAE;IAC/B;IAEA,IAAI,CAACF,iBAAiB,CAACK,GAAG,CAACR,IAAI,EAAEM,QAAQ,CAAC;IAC1C,OAAOA,QAAQ;EACjB;EAEA;;;EAGAC,WAAW,CAACN,uBAAgD;IAC1D,IAAIA,uBAAuB,CAACQ,mBAAmB,EAAE;MAC/C,OAAO,IAAIC,+CAAqB,CAC9B,IAAIC,wBAAU,EAAE,EAChBV,uBAAuB,CAACQ,mBAAmB,CAC5C;IACH,CAAC,MAAM,IAAIR,uBAAuB,CAACW,aAAa,EAAE;MAChD,OAAO,IAAIC,uDAAyB,CAAC,IAAIF,wBAAU,EAAE,EAAEV,uBAAuB,CAACW,aAAa,CAAC;IAC/F,CAAC,MAAM;MACL,MAAME,WAAW,GAAGb,uBAAuB,CAACc,WAAW;MACvD,MAAM3B,QAAQ,GAAGC,6BAAc,CAACe,GAAG,CAACU,WAAW,CAAC,IAAI;MACpD,IAAI,CAAC1B,QAAQ,EAAE;QACb,MAAM,IAAIJ,iCAAyB,CACjC,2CAA2CiB,uBAAuB,CAACc,WAAW,EAAE,CACjF;MACH;MACA,OAAO3B,QAAQ;IACjB;EACF;;AA1DF4B","names":["AUTH_PROVIDERS","Map","providers_1","MONGODB_AWS","mongodb_aws_1","MONGODB_CR","error_1","MONGODB_GSSAPI","gssapi_1","MONGODB_OIDC","workflow","mongodb_oidc_1","MONGODB_PLAIN","plain_1","MONGODB_SCRAM_SHA1","scram_1","MONGODB_SCRAM_SHA256","MONGODB_X509","x509_1","MongoClientAuthProviders","constructor","getOrCreateProvider","name","authMechanismProperties","authProvider","existingProviders","get","providerFunction","provider","getWorkflow","set","OIDC_HUMAN_CALLBACK","human_callback_workflow_1","token_cache_1","OIDC_CALLBACK","automated_callback_workflow_1","environment","ENVIRONMENT","exports"],"sources":["/home/yadu/Music/Gifty/node_modules/mongodb/src/mongo_client_auth_providers.ts"],"sourcesContent":["import { type AuthProvider } from './cmap/auth/auth_provider';\nimport { GSSAPI } from './cmap/auth/gssapi';\nimport { type AuthMechanismProperties } from './cmap/auth/mongo_credentials';\nimport { MongoDBAWS } from './cmap/auth/mongodb_aws';\nimport { MongoDBOIDC, OIDC_WORKFLOWS, type Workflow } from './cmap/auth/mongodb_oidc';\nimport { AutomatedCallbackWorkflow } from './cmap/auth/mongodb_oidc/automated_callback_workflow';\nimport { HumanCallbackWorkflow } from './cmap/auth/mongodb_oidc/human_callback_workflow';\nimport { TokenCache } from './cmap/auth/mongodb_oidc/token_cache';\nimport { Plain } from './cmap/auth/plain';\nimport { AuthMechanism } from './cmap/auth/providers';\nimport { ScramSHA1, ScramSHA256 } from './cmap/auth/scram';\nimport { X509 } from './cmap/auth/x509';\nimport { MongoInvalidArgumentError } from './error';\n\n/** @internal */\nconst AUTH_PROVIDERS = new Map<AuthMechanism | string, (workflow?: Workflow) => AuthProvider>([\n  [AuthMechanism.MONGODB_AWS, () => new MongoDBAWS()],\n  [\n    AuthMechanism.MONGODB_CR,\n    () => {\n      throw new MongoInvalidArgumentError(\n        'MONGODB-CR is no longer a supported auth mechanism in MongoDB 4.0+'\n      );\n    }\n  ],\n  [AuthMechanism.MONGODB_GSSAPI, () => new GSSAPI()],\n  [AuthMechanism.MONGODB_OIDC, (workflow?: Workflow) => new MongoDBOIDC(workflow)],\n  [AuthMechanism.MONGODB_PLAIN, () => new Plain()],\n  [AuthMechanism.MONGODB_SCRAM_SHA1, () => new ScramSHA1()],\n  [AuthMechanism.MONGODB_SCRAM_SHA256, () => new ScramSHA256()],\n  [AuthMechanism.MONGODB_X509, () => new X509()]\n]);\n\n/**\n * Create a set of providers per client\n * to avoid sharing the provider's cache between different clients.\n * @internal\n */\nexport class MongoClientAuthProviders {\n  private existingProviders: Map<AuthMechanism | string, AuthProvider> = new Map();\n\n  /**\n   * Get or create an authentication provider based on the provided mechanism.\n   * We don't want to create all providers at once, as some providers may not be used.\n   * @param name - The name of the provider to get or create.\n   * @param credentials - The credentials.\n   * @returns The provider.\n   * @throws MongoInvalidArgumentError if the mechanism is not supported.\n   * @internal\n   */\n  getOrCreateProvider(\n    name: AuthMechanism | string,\n    authMechanismProperties: AuthMechanismProperties\n  ): AuthProvider {\n    const authProvider = this.existingProviders.get(name);\n    if (authProvider) {\n      return authProvider;\n    }\n\n    const providerFunction = AUTH_PROVIDERS.get(name);\n    if (!providerFunction) {\n      throw new MongoInvalidArgumentError(`authMechanism ${name} not supported`);\n    }\n\n    let provider;\n    if (name === AuthMechanism.MONGODB_OIDC) {\n      provider = providerFunction(this.getWorkflow(authMechanismProperties));\n    } else {\n      provider = providerFunction();\n    }\n\n    this.existingProviders.set(name, provider);\n    return provider;\n  }\n\n  /**\n   * Gets either a device workflow or callback workflow.\n   */\n  getWorkflow(authMechanismProperties: AuthMechanismProperties): Workflow {\n    if (authMechanismProperties.OIDC_HUMAN_CALLBACK) {\n      return new HumanCallbackWorkflow(\n        new TokenCache(),\n        authMechanismProperties.OIDC_HUMAN_CALLBACK\n      );\n    } else if (authMechanismProperties.OIDC_CALLBACK) {\n      return new AutomatedCallbackWorkflow(new TokenCache(), authMechanismProperties.OIDC_CALLBACK);\n    } else {\n      const environment = authMechanismProperties.ENVIRONMENT;\n      const workflow = OIDC_WORKFLOWS.get(environment)?.();\n      if (!workflow) {\n        throw new MongoInvalidArgumentError(\n          `Could not load workflow for environment ${authMechanismProperties.ENVIRONMENT}`\n        );\n      }\n      return workflow;\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}